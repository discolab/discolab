#!/usr/bin/env node

const path = require('path');
const { load: loadEnv } = require('dotenv');
const webpack = require('webpack');
const WebpackDevServer = require('webpack-dev-server');
const webpackConfig = require('../client/webpack.config');

loadEnv({ path: path.join(__dirname, '../.env') });

const compiler = webpack(webpackConfig(process.env));

if (process.env.NODE_ENV === 'development') {
  const server = new WebpackDevServer(compiler, {
    contentBase: path.join(__dirname, '../client')
  });

  server.listen(9400, function(errorMessage) {
    if(errorMessage) {
      throw new Error(errorMessage);
    }
  });
} else {
  compiler.run((err, stats) => {
    if (err) {
      console.log(err)
    }
    console.log(stats.toString())
  })
}

